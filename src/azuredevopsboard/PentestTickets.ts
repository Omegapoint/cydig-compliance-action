import * as core from '@actions/core';
import { AzureDevOpsConnection } from '../helpfunctions/AzureDevOpsConnection';
import { PenetrationTestTicketService } from './PenetrationTestTicketService';
import { DevOpsBoard } from '../types/DevOpsBoard';

export class PentestTickets {
    static async setPentestTickets(azureDevOpsConnection: AzureDevOpsConnection, board: DevOpsBoard): Promise<void> {
        console.log('Getting penetration test tickets');
        const penetrationTestTicketService: PenetrationTestTicketService = new PenetrationTestTicketService(
            azureDevOpsConnection.getConnection(),
            board.projectId,
            board.pentestTag,
        );
        const numberOfTickets: {
            numberOfActiveTickets: number;
            numberOfClosedTickets: number;
        } = await penetrationTestTicketService.getPenetrationTestTickets(board.nameOfBoards);

        console.log('Active penetration test tickets: ' + numberOfTickets.numberOfActiveTickets);
        console.log('Closed penetration test tickets : ' + numberOfTickets.numberOfClosedTickets);

        core.exportVariable('ptNumberOfActiveTickets', numberOfTickets.numberOfActiveTickets.toString());
        core.exportVariable('ptNumberOfClosedTickets', numberOfTickets.numberOfClosedTickets.toString());
        return;
    }
}
